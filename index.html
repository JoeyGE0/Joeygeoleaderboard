<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <h1 class="top-bar">
        <span>
            <strong>&nbsp; &nbsp;<span class="custom-text">GCAE88J - Live Leaderboard</span></strong>
        </span>
    </h1>
    
    <title>Leaderboard</title>
    <link rel="stylesheet" href="style.css">
    <style>

.top-bar {
            background-color: #5900ff;
            height: 50px;
            margin: 0; /* Remove default margin */
            border-radius: 0; /* Remove border-radius to make it straight to the edge */
            padding: 0; /* Remove padding to make it flush with the edges */
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
        }
        
        .custom-text {
            position: absolute;
            top: 22px;
            left: 20px;
            font-size: 13px;
            letter-spacing: .020em;
            font-family: SF Pro Display, SF Pro Icons, Helvetica Neue, Helvetica, Arial, sans-serif;
            font-weight: 550;
            color: #ffffff;
            cursor: pointer;
        }


        /* Light mode styles */
body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: white;
    color: black;
}

/* Dark mode styles */
@media (prefers-color-scheme: dark) {
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: black;
    color: white;
  }
}


        h1, h2 {
            color: #333;
            padding-top: 20px;
            padding-bottom: 20px;
        }

                /* Dark mode styles */
@media (prefers-color-scheme: dark) {
    h1, h2 {
    color: #ffffff; /* Set the text color for dark mode here */
  }
}


        button {
    background-color: #5e4dcd;
    color: white;
    padding: 7px 15px; /* Keep this as is */
    border: none;
    cursor: pointer;
    margin-top: 10px;
    border-radius: 0 6px 6px 0;
}

input {
    padding: 7px 2px; /* Set padding to match the button */
    margin: 5px;
    margin-right: -4px;
    border-radius: 4px;
    font-size: 12px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    border: 1px solid #5e4dcd;
    border-radius: 6px 0 0 6px;
    background-color: transparent;
    transition: background-color .3s ease-in-out;
}

                /* Dark mode styles */
                @media (prefers-color-scheme: dark) {
    input {
    color: #ffffff; /* Set the text color for dark mode here */
  }
}


button:hover {
    background-color: #5e5dcd;
}



        ol {
            list-style-type: none;
            padding: 0;
        }


        li {
            background-color: #f7f7f7;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
        }

                        /* Dark mode styles */
@media (prefers-color-scheme: dark) {
    li {
    color: #ffffff; /* Set the text color for dark mode here */
    background-color: #454545;
  }
}
        

        /* Style for the greyed-out button */
        button[disabled] {
            background-color: grey;
            cursor: not-allowed; /* Change the cursor to a "not-allowed" symbol */
        }

        #resetButton {
            background-color: #ff3333;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
        }



/* Add unique class names to the suggestions */
.suggestion-container {
    position: relative;
}

.suggestion-list {
    position: absolute;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
    max-height: 120px;
    overflow-y: auto;
    background-color: rgb(241, 239, 239);
    z-index: 1;
    width: 50%; /* Adjust width as needed */
}

                        /* Dark mode styles */
    @media (prefers-color-scheme: dark) {
    .suggestion-list {
    color: #ffffff; /* Set the text color for dark mode here */
    background-color: #454545;
    box-shadow: 0 2px 4px rgba(21, 21, 21, 0.4);
  }
}

.suggestion-item {
    padding: 8px;
    cursor: pointer;
    font-size: 10px;
}

.suggestion-item:hover {
    background-color: #f0f0f0;
}

@media (prefers-color-scheme: dark) {
.suggestion-item:hover {
    background-color: #4f4f4f;
  }
}


footer {
            background-color: #efefef00; /* Background color for the footer */
            padding: 10px; /* Add some padding for spacing */
            text-align: center; /* Center-align the text */
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            font-weight: 550;
        }

        /* Style for the smaller text below */
        footer p.small-text {
            font-size: 10px; /* Adjust the font size to your preference */
            margin-top: 8px; /* Add some space between the lines */
            font-weight: lighter;
        }


        .highlight {
    		animation: glow 1s ease-in-out infinite;
	}
	
    @keyframes glow {
		0%,
		100% {
			text-shadow: 0 0 5px rgb(174, 255, 0);
		}
		50% {
			text-shadow: 0 0 10px #ffffff00;
		}
	}
        
    </style>
</head>
<body>

    <h1>Leaderboard</h1>
    <div style="display: inline-block;">
        <div class="suggestion-container">
            <input type="text" id="nameInput" placeholder="Enter Your Geo-Name" minlength="3" maxlength="24">
            <div id="suggestionList" class="suggestion-list"></div>
            <button onclick="addEntry()" title="Click to Add to Leaderboard">Add to Leaderboard</button>
        </div>

    </div>
    <div id="leaderboard">
        <h2>Top Times</h2>
        <ol id="leaderList">
            <!-- Leaderboard entries will go here -->
        </ol>
    </div>
    


    <input type="text" id="manualTimeInput" placeholder="Enter time (seconds)">
    <button onclick="addManualTime()" title="Manual Time">Manual Time</button>
    


<input type="number" id="timeLimitInput" value="30" min="1"  placeholder="Default: 30(min)">
<button onclick="setDisqualificationTimeLimit()" title="Max Allowed time" >Set Limit</button>
<button id="resetButton" onclick="resetMemory()">Reset Board</button>
<div id="leaderboard">
    <ol id="leaderList">
        <!-- Leaderboard entries will go here -->
    </ol>
</div>


<div id="disqualifiedSection" style="display: none;">
    <h2>You Have Been Disqualified!</h2>
    <h6>Please Enter Name And Try Again</h6>
    <ul id="disqualifiedList">
        <!-- Disqualified entries will go here -->
    </ul>
</div>

<footer>
    <div>
        <p>You have reached the end.</p>
    </div>
    <p class="small-text">A cache by JoeyGE0</p>
</footer>

    <script>
const leaderboard = document.getElementById('leaderList');
const nameInput = document.getElementById('nameInput');
const addButton = document.querySelector('button');
const esp32DataInput = document.getElementById('esp32Data');
const esp32Button = document.getElementById('esp32Button');
const manualTimeInput = document.getElementById('manualTimeInput');
const manualTimeButton = document.getElementById('manualTimeButton');
const timeLimitInput = document.getElementById('timeLimitInput');
const disqualifiedSection = document.getElementById('disqualifiedSection');
const disqualifiedList = document.getElementById('disqualifiedList');

let disqualificationTimeLimit = 30 * 60; // Default to 30 minutes in seconds

// Check if a name is already stored in local storage
let storedName = localStorage.getItem('leaderboardName');

if (storedName) {
    // If a name is found, enable the input for a new name
    nameInput.value = storedName;
    addButton.disabled = false;
    nameInput.disabled = true;
    addButton.style.backgroundColor = 'grey'; // Change the button color to grey
} else {
    // If no name is found, enable the input for a new name
    nameInput.disabled = false;
    addButton.disabled = false;
}

// Check if leaderboard data is already stored in local storage
const storedLeaderboard = localStorage.getItem('leaderboardData');

// Initialize the leaderboard with the stored data or an empty array
const leaderboardData = storedLeaderboard ? JSON.parse(storedLeaderboard) : [];

// Check if disqualified names are stored in local storage
const storedDisqualifiedNames = localStorage.getItem('disqualifiedNames');

// Initialize the disqualified names with the stored data or an empty array
const disqualifiedNames = storedDisqualifiedNames ? JSON.parse(storedDisqualifiedNames) : [];

// Update the leaderboard display based on the stored data
for (const entryData of leaderboardData) {
    const entry = document.createElement('li');
    const formattedTime = entryData.time.startsWith('time: ') ? entryData.time : `time: ${entryData.time}`;
    entry.innerHTML = `<strong>${entryData.name}</strong>: ${formattedTime}`;
    leaderboard.appendChild(entry);
}

// Remove disqualified names from the main leaderboard during initialization
for (const disqualifiedName of disqualifiedNames) {
    const mainLeaderboardEntries = leaderboard.querySelectorAll('li');
    for (const entry of mainLeaderboardEntries) {
        const entryName = entry.querySelector('strong').textContent;
        if (entryName === disqualifiedName) {
            entry.remove();
            break;
        }
    }
}

function addEntry() {
    const name = nameInput.value.trim();

    if (name === '') {
        alert('Please enter a name.');
        return;
    }

    const entry = document.createElement('li');
    entry.innerHTML = `<strong>${name}</strong>: Waiting for data..`;

    // Check if this entry's name matches the name in the input box and add the "highlight" class
    if (name === nameInput.value.trim()) {
                entry.classList.add('highlight');
            }

    leaderboard.appendChild(entry);

    // Store the entered name in local storage
    localStorage.setItem('leaderboardName', name);

    // Disable the input and change the button color to grey after adding the name
    nameInput.disabled = true;
    addButton.disabled = true;
    addButton.style.backgroundColor = 'grey'; // Change the button color to grey

    // Clear input field
    nameInput.value = '';

    // Add the entry data to the leaderboard data
    const entryData = { name, time: 'N/A' };
    leaderboardData.push(entryData);

    // Update the stored leaderboard data
    localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData));
}

function updateEntry(name, time) {
    const entries = leaderboard.querySelectorAll('li');

    // Find the entry with the matching name and update it
    for (const entry of entries) {
        const entryName = entry.querySelector('strong').textContent;
        if (entryName === name) {
            // Check if the entry already has a "time: " prefix
            if (time.startsWith('time: ')) {
                entry.innerHTML = `<strong>${name}</strong>: ${time}`;
            } else {
                entry.innerHTML = `<strong>${name}</strong>: time: ${time}`;
            }
            break;
        }
    }

    // Update the leaderboard data with the received time
    const updatedEntry = leaderboardData.find((entryData) => entryData.name === name);
    if (updatedEntry) {
        updatedEntry.time = time;

        // Update the stored leaderboard data
        localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData));
    }

    // Check if the time exceeds the disqualification time limit
    if (time.startsWith('time: ')) {
        const timeInSeconds = parseInt(time.split(' ')[1]);
        if (timeInSeconds > disqualificationTimeLimit) {
            // Disqualify the user and display the reason
            disqualifyUser(name, 'over the time limit', disqualificationTimeLimit);
        }
    }
}

// Simulate receiving data from the ESP32 and update the leaderboard
function simulateESP32() {
    const esp32Data = esp32DataInput.value.trim();

    if (esp32Data === '') {
        alert('Please enter ESP32 data.');
        return;
    }

    // Assuming you have a function to process the ESP32 data and get the time
    // For example, let's say you have a function called processDataFromESP32
    const timeFromESP32 = processDataFromESP32(esp32Data);

    if (timeFromESP32 !== null) {
        // Get the user's name from local storage
        const userName = localStorage.getItem('leaderboardName');

        if (userName) {
            // Update the leaderboard with the received time for the user
            updateEntry(userName, timeFromESP32);
        } else {
            alert('No user name found. Please enter your name first.');
        }

        esp32DataInput.value = ''; // Clear the input field
    } else {
        alert('Invalid ESP32 data. Please check the format.');
    }
}

// Handle manual time entry
function addManualTime() {
    const time = manualTimeInput.value.trim();

    if (time === '') {
        alert('Please enter a time.');
        return;
    }

    // Get the user's name from local storage
    const userName = localStorage.getItem('leaderboardName');

    if (userName) {
        // Update the leaderboard with the manually entered time for the user
        const formattedTime = time.startsWith('time: ') ? time : `time: ${time}`;
        updateEntry(userName, formattedTime);
        manualTimeInput.value = ''; // Clear the input field
    } else {
        alert('No user name found. Please enter your name first.');
    }
}

// Set the disqualification time limit
function setDisqualificationTimeLimit() {
    const newLimit = parseInt(timeLimitInput.value);
    if (!isNaN(newLimit) && newLimit >= 1) {
        disqualificationTimeLimit = newLimit * 60; // Convert minutes to seconds
        alert(`Disqualification time limit set to ${newLimit} minutes.`);
    } else {
        alert('Please enter a valid time limit (in minutes).');
    }
}

function disqualifyUser(name, reason, timeLimit) {
    const entry = document.createElement('li');
    entry.innerHTML = `<strong>${name}</strong>: Disqualified (${reason}, Time Limit: ${timeLimit / 60} minutes)`;
    disqualifiedList.appendChild(entry);
    // Display the disqualified section
    disqualifiedSection.style.display = 'block';

    // Remove the user's entry from the main leaderboard
    const mainLeaderboardEntries = leaderboard.querySelectorAll('li');
    for (const entry of mainLeaderboardEntries) {
        const entryName = entry.querySelector('strong').textContent;
        if (entryName === name) {
            entry.remove();
            break;
        }
    }

    // Allow the user to enter a new name
    nameInput.disabled = false;
    addButton.disabled = false;
    addButton.style.backgroundColor = '';
    localStorage.removeItem('leaderboardName'); // Clear the stored name

    // Store the disqualified name in local storage
    disqualifiedNames.push(name);
    localStorage.setItem('disqualifiedNames', JSON.stringify(disqualifiedNames)); // Save disqualified names

    // Update the leaderboard data after removing the disqualified name
    const updatedLeaderboardData = leaderboardData.filter((entryData) => entryData.name !== name);
    leaderboardData.length = 0;
    leaderboardData.push(...updatedLeaderboardData);
    localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData)); // Update leaderboard data

// Check if the time exceeds the disqualification time limit and display the user's name
if (timeLimit !== undefined && timeLimit !== null) {
    if (timeLimit <= 0) {
        alert(`Time Limit reached! User: "${name}" has been disqualified.`);
    } else {
        alert(`User: "${name}" is disqualified due to: ${reason}. You exceeded timeout time of ${timeLimit} seconds.`);
    }
 }

}

// This is a placeholder function; replace it with your actual ESP32 data processing logic
function processDataFromESP32(data) {
    // Here, you should parse the data and extract the time
    // For example, if your data format is 'time=XX', you can do something like this:
    const timeMatch = data.match(/time=(\d+)/);
    if (timeMatch) {
        const timeInSeconds = parseInt(timeMatch[1]);
        return `time: ${timeInSeconds}`;
    }
    return null; // Return null if the data format is invalid
}

function resetMemory() {
    // Clear the name from local storage
    localStorage.removeItem('leaderboardName');

    // Alert
    const userConfirmed = window.confirm("ARE YOU SURE YOU WANT TO CLEAR STORAGE! THIS CANNOT BE UNDONE!");
    
    // Check if the user clicked "Cancel"
    if (userConfirmed) {
        // User clicked "OK" or closed the dialog
        alert("Deleting...");
        // Clear the leaderboard data from local storage
        localStorage.removeItem('leaderboardData');
        // Clear disqualified names from local storage
        localStorage.removeItem('disqualifiedNames');
        // Refresh the page to clear the displayed data
        location.reload();
    }
}

// Array of keywords for autocomplete
const keywords = ["rattll", "Popmac", "tmann421", "huhugrub", "Phronimos", "TwigNZ", "Pushn East", "the Seagnoid", "Etherlord Clan", "geodatum", "haydn.seek", "skindo", "Yeetrees", "watcache", "searchSteve", "LGLNZ", "mar1sa", "Firewoof", "YetiNZ", "funkymunkyzone", "Mr-Mcgoo", "supasi", "all7ofusnz", "sunju", "GSEL", "edvern", "woolwood9", "spudnz", "barefootguru", "stardust718", "markhnz", "mjmnz", "tommygun9", "NZ B", "Rubbishparty", "Flowerydaze", "LL113", "JoeyGE0 :)", "wb1116", "Swaybars", "LNM1961", "tahlia2006", "capperz", "-gonefishing-", "helbaby7", "Talla64", "AtomsNZ", "brucewwnz", "saveva", "4Tees", "taybee nz", "bruzie", "2 Bulbars", "KayGeeDee", "Gr33nslime", "11hpg11", "Gorbygorbachov", "Scoria", "MIOW4", "PIMacNZ", "Just-Lookin", "Jamogen", "Itchyfeet2020", "jono s", "FapAndGap", "matagouri tramyard", "suepate", "coleybags", "Geckoh", "CrystalFairy", "Juty Bug", "Davidson123Clan", "Teeps & Mum", "squirrel nutcase", "jimmynz", "2wombles", "ThatWeirdGuy04", "Philip.Perry", "Jodiporsche", "3Prettys", "Troodles", "Ewakef", "TaraTed", "JÃ¤gersmum", "Mc Jandals", "rosmar", "Justlooking00", "RogerWInz", "fuzzball56", "NZFlossy", "nightowl19", "skeetinnz", "fanfan-77", "jesso22", "LeftyNZ", "julietlalpha", "emiliyah", "TrinityNZ", "deltatea", "alsjfs", "TreMichLan", "ADV", "Marchwood", "ritaryanandjj", "Lostcourse", "taybee", "NumptyBum", "kiwicouple", "Punga and Paua", "Emvy_Us", "rustynz", "Isis58", "D6nz", "Nosynel", "Denomynator", "Niscar", "DangerSAM", "loopysue"];

const suggestionList = document.getElementById('suggestionList');

// Function to handle input change and show autocomplete suggestions
function handleInputChange() {
    const inputValue = nameInput.value.toLowerCase(); // Convert input to lowercase for case-insensitive matching

    // Filter keywords that start with the input value
    const suggestions = keywords.filter(keyword => keyword.toLowerCase().startsWith(inputValue));

    // Display the suggestions
    suggestionList.innerHTML = ''; // Clear previous suggestions

    // Create div elements for each suggestion
    suggestions.forEach(suggestion => {
        const div = document.createElement('div');
        div.textContent = suggestion;
        div.classList.add('suggestion-item'); // Add the suggestion-item class
        div.addEventListener('click', () => {
            // Fill the input with the selected suggestion
            nameInput.value = suggestion;
            // Clear the suggestion list
            suggestionList.innerHTML = '';
        });
        suggestionList.appendChild(div);
    });

    // Show or hide the suggestion list based on whether there are suggestions
    if (suggestions.length > 0) {
        suggestionList.style.display = 'block';
    } else {
        suggestionList.style.display = 'none';
    }
}

// Add event listeners for input and click outside to hide suggestions
nameInput.addEventListener('input', handleInputChange);
document.addEventListener('click', (event) => {
    if (event.target !== nameInput) {
        suggestionList.style.display = 'none';
    }
});

// Function to display a data usage warning with just an "OK" button
function showDataUsageWarning() {
    alert("This action may use your mobile data and may incur charges. Click 'OK' to acknowledge.");
}

// Function to run when the page opens
function onPageLoad() {
    // You can run other tasks here when the page loads
}

// Add an event listener for page load
window.addEventListener('load', onPageLoad);


    </script>

    
</body>
</html>
